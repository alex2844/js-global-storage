var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var a,c=[];!(a=b.next()).done;)c.push(a.value);return c};
$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.getGlobal=function(b){b=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,b];for(var a=0;a<b.length;++a){var c=b[a];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.polyfill=function(b,a,c,f){if(a){c=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var d=b[f];d in c||(c[d]={});c=c[d]}b=b[b.length-1];f=c[b];a=a(f);a!=f&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("globalThis",function(b){return b||$jscomp.global},"es_next","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,a){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:a})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function b(c){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+a++,c)}var a=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,f={next:function(){if(c<b.length){var d=c++;return{value:a(d,b[d]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function a(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(c,d){c(a)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;a.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})}this.batch_.push(a)};var f=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){f(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var d=a[c];a[c]=null;try{d()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(l){c.reject(l)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(b){d||(d=!0,a.call(c,b))}}var c=this,d=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(l){this.reject_(l);return}"function"==typeof c?
this.settleSameAsThenable_(c,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var g=new a;d.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};d.prototype.settleSameAsThenable_=function(a,c){var d=this.createResolveAndReject_();try{a.call(c,d.resolve,d.reject)}catch(m){d.reject(m)}};d.prototype.then=function(a,c){function b(a,c){return"function"==typeof a?function(c){try{f(a(c))}catch(n){g(n)}}:c}var f,g,h=new d(function(a,c){f=a;g=c});this.callWhenSettled_(b(a,f),b(c,g));return h};
d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,c){function d(){switch(b.state_){case 1:a(b.result_);break;case 2:c(b.result_);break;default:throw Error("Unexpected state: "+b.state_);}}var b=this;null==this.onSettledCallbacks_?g.asyncExecute(d):this.onSettledCallbacks_.push(d)};d.resolve=c;d.reject=function(a){return new d(function(c,d){d(a)})};d.race=function(a){return new d(function(d,b){for(var f=$jscomp.makeIterator(a),g=f.next();!g.done;g=f.next())c(g.value).callWhenSettled_(d,
b)})};d.all=function(a){var b=$jscomp.makeIterator(a),f=b.next();return f.done?c([]):new d(function(a,d){function g(c){return function(d){h[c]=d;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,c(f.value).callWhenSettled_(g(h.length-1),d),f=b.next();while(!f.done)})};return d},"es6","es3");$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var f=b.length,d=0;d<f;d++){var g=b[d];if(a.call(c,g,d,b))return{i:d,v:g}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");
(function(){var b=function(a){var c=this;if(a&&(a.url&&-1<a.url.indexOf("//docs.google.com/spreadsheets/d/")&&(a.spreadsheet=a.url.split("/d/")[1].split("/")[0],delete a.url),a.spreadsheet)){if(!a.proxy&&-1<navigator.userAgent.indexOf("/bot"))a.proxy="https://proxy.fetchcors.workers.dev/";else if(!document.querySelector('link[href="https://spreadsheets.google.com"]')){var b=document.createElement("link");b.rel="preconnect";b.href="https://spreadsheets.google.com";document.getElementsByTagName("head")[0].appendChild(b)}Object.defineProperty(this,
"#cache",{value:new Proxy({},{get:function(a,c){return(localStorage.sheetStorageCache?JSON.parse(localStorage.sheetStorageCache):{})[c]},set:function(a,c,b){a=localStorage.sheetStorageCache?JSON.parse(localStorage.sheetStorageCache):{};a[c]={time:Math.round((new Date).getTime()/1E3),body:b};localStorage.sheetStorageCache=JSON.stringify(a);return!0}}),enumerable:!1})}Object.defineProperty(this,"#opts",{value:a||null,enumerable:!1});!("BroadcastChannel"in window)||this["#opts"]&&this["#opts"].spreadsheet||
(Object.defineProperty(this,"#broadcast",{value:new BroadcastChannel("globalStorageBroadcast:"+this.hash(this["#opts"])),enumerable:!1}),this["#broadcast"].addEventListener("message",function(a){c["#opts"].providers&&(c["#data"]=JSON.parse(localStorage.getItem("syncStorageCache"+(c["#opts"].prefix?"_"+c["#opts"].prefix:""))),c.reload());window.dispatchEvent(c.globalStorageEvent(a.data))}));return this.reload(!0)};b.prototype.globalStorageEvent=function(a){return Object.defineProperties(new CustomEvent(a.type),
{id:{value:this["#broadcast"].name,enumerable:!0},key:{value:a.key||null,enumerable:!0},oldValue:{value:a.oldValue||null,enumerable:!0},newValue:{value:a.newValue||null,enumerable:!0},url:{value:a.url||null,enumerable:!0},storageArea:{value:this,enumerable:!0}})};b.prototype.reload=function(a){var c=this;a||Object.keys(this).forEach(function(a){return delete c[a]});if(this["#opts"]){if(this["#opts"].spreadsheet)return(this["#opts"].lists||this["#cache"][this["#opts"].spreadsheet]&&3600>Math.round((new Date).getTime()/
1E3)-this["#cache"][this["#opts"].spreadsheet].time&&(this["#opts"].lists=this["#cache"][this["#opts"].spreadsheet].body)?new Promise(function(a,b){return a(c["#opts"].lists)}):fetch((this["#opts"].proxy||"")+"https://spreadsheets.google.com/feeds/worksheets/"+this["#opts"].spreadsheet+"/public/basic?alt=json").then(function(a){return a.json().then(function(a){return c["#cache"][c["#opts"].spreadsheet]=a.feed.entry.map(function(a){return{id:a.id.$t.split("/").slice(-1)[0],title:a.content.$t,time:Math.round((new Date(a.updated.$t)).getTime()/
1E3)}})})})).then(function(a){a.forEach(function(a){return Object.defineProperty(c,a.title,{enumerable:!0,get:function(){return this.fetchList(a.id)}})});var b=Object.getOwnPropertyNames(c.__proto__).concat(["then"]);return new Proxy(c,{get:function(a,c){return-1!=b.indexOf(c)||a.hasOwnProperty(c)?a[c]:new Promise(function(a,c){return c()})}})});if(this["#opts"].providers){if(a){var f="syncStorageCache"+(this["#opts"].prefix?"_"+this["#opts"].prefix:"");Object.defineProperties(this,{"#timers":{value:{},
enumerable:!1,writable:!0,configurable:!0},"#data":{value:localStorage.getItem(f)?JSON.parse(localStorage.getItem(f)):[b.merge(b.default(this["#opts"].default))],enumerable:!1,writable:!0,configurable:!0}});return this.auth(null)}console.log("reload");a=b.merge.apply(b,$jscomp.arrayFromIterable(this["#data"].map(function(a){return a.config})));for(f in a)Object.defineProperty(this,f,{value:a[f],enumerable:!0,writable:!0,configurable:!0})}else this["#opts"].cookie&&document.cookie.split("; ").filter(function(a){return a}).forEach(function(a){return c[a.split("=")[0]]=
a.split("=").slice(1).join("=")})}return this.__isProxy?this:new Proxy(this,{set:function(a,b,f){console.log("SET",{obj:a,key:b,val:f});c.save(b,a[b],a[b]=f);return!0},get:function(a,c){return"__isProxy"!==c?a[c]:!0}})};b.prototype.users=function(){return this["#data"].map(function(a){return a.user}).filter(function(a){return a})};b.prototype.users_add=function(a,c,f){var d=this;console.log("add",{user:a});if(this.users().length)console.log("adding 2 user");else{if(a){var g,h=this.users();a=a.getBasicProfile();
var k={id:a.getEmail(),name:a.getName(),iconURL:a.getImageUrl(),provider:"https://accounts.google.com"};window.PasswordCredential&&navigator.credentials.store(new FederatedCredential(k));-1<(g=h.length?h.findIndex(function(a){return a.id==k.id}):0)?this["#data"][g].user=k:g=this["#data"].push(b.merge(b.default(this["#opts"].default),{user:k}))-1;console.log("USER",k,g);return c(this.fetchFind())}gapi.auth2.getAuthInstance().signIn().then(function(a){return d.users_add(a,c,f)},function(a){return f(a)})}};
b.prototype.gapi=function(){return new Promise(function(a,c){if("gapi"in window)return gapi.load("client",function(){return a()});var b=document.createElement("script");b.src="https://apis.google.com/js/api.js";b.addEventListener("load",function(){return gapi.load("client",function(){return a()})});b.addEventListener("error",function(a){return c(a)});document.body.appendChild(b)})};b.prototype.auth=function(a,c,b){var d=this;return c&&b?gapi.client.init({apiKey:this["#opts"].providers.google.key,
clientId:this["#opts"].providers.google.id,scope:"https://www.googleapis.com/auth/drive.appfolder email profile"}).then(function(){console.log("init",{id:a});if(a){var f=gapi.auth2.getAuthInstance();if(f.isSignedIn.get()){var h=f.currentUser.get();if(h.getBasicProfile().getEmail()===a)return d.users_add(h,c,b)}f.signIn({login_hint:a||""}).then(function(a){return d.users_add(a,c,b)},function(a){return b(a)})}else d.users().length?c():d.users_add(null,c,b)},function(a){b(a)}):(new Promise(function(c,
b){d.users().length||null!==a?d.gapi().then(function(){return d.auth(a,c,b)}):null===a?d.credentials("silent").then(function(a){return a?d.auth(a).then(function(){return c()}).catch(function(){return b()}):c()}):c()})).then(function(){return d.reload()})};b.prototype.credentials=function(a){return window.PasswordCredential?navigator.credentials.get({federated:{providers:["https://accounts.google.com"]},mediation:a}).then(function(a){if(!a)return null;switch(a.type){case "federated":switch(a.provider){case "https://accounts.google.com":return a.id}}}):
new Promise(function(a,b){return a(null)})};b.prototype.fetchFind=function(a){var c=this,b="syncStorage"+(this["#opts"].prefix?"_"+this["#opts"].prefix:"");return new Promise(function(d,f){if(c["#data"][0].id)return d();console.log("Finded remote file");gapi.client.request({path:"/drive/v3/files",params:{spaces:"appDataFolder",fields:"files(id, name)",pageSize:500,q:"name = '"+b+"_config.json'",orderBy:"createdTime"}}).then(function(g){g.result.files.length?(console.log("find file",g.result.files),
d(c.fetchConfigLoad(a,c["#data"][0].id=g.result.files[0].id))):gapi.client.request({path:"/drive/v3/files/",method:"POST",body:{name:b+"_config.json",mimeType:"application/json",parents:["appDataFolder"]}}).then(function(a){console.log("create file",a.result);d(c["#data"][0].id=a.result.id)},function(a){return f(a)})},function(a){return f(a)})})};b.prototype.fetchConfigLoad=function(a){var c=this;return new Promise(function(f,d){if(!c["#data"][0].id)return f();console.log("fetchConfigLoad");gapi.client.request({path:"/drive/v3/files/"+
c["#data"][0].id,params:{alt:"media"}}).then(function(a){a.result?(console.log("BODY",c["#data"][0].config,a.result),c["#data"][0].config=b.merge(c["#data"][0].config,a.result)):console.log("BODY",a);c.save();return f()},function(b){console.log("error fetchConfigLoad");a?d(e):f(c.fetchFind(!0,c["#data"][0].id=null))})})};b.prototype.fetchList=function(a){var c=this;return(this["#cache"][this["#opts"].spreadsheet+"/"+a]&&3600>Math.round((new Date).getTime()/1E3)-this["#cache"][this["#opts"].spreadsheet+
"/"+a].time?new Promise(function(b,d){return b(c["#cache"][c["#opts"].spreadsheet+"/"+a].body)}):fetch((this["#opts"].proxy||"")+"https://spreadsheets.google.com/feeds/cells/"+this["#opts"].spreadsheet+"/"+(a||"od6")+"/public/values?alt=json").then(function(b){return b.json().then(function(b){return c["#cache"][c["#opts"].spreadsheet+"/"+a]=b.feed.entry?b.feed.entry.reduce(function(a,c){for(;a.length<c.gs$cell.row;)a.push([]);for(var b=a[a.length-1];b.length+1<c.gs$cell.col;)b.push("");b.push(c.content.$t);
return a},[]):[]})})).then(function(a){return Object.defineProperties({},{cells:{value:a,enumerable:!0},json:{enumerable:!0,get:function(){return a.slice(1).reduce(function(c,b){c.push(b.reduce(function(c,b,d){c[a[0][d]]=b;return c},{}));return c},[])}}})})};b.prototype.hash=function(a){return("string"==typeof a?a:JSON.stringify(a)).split("").reduce(function(a,b){a=(a<<5)-a+b.charCodeAt(0);return a&a},0)};b.prototype.getItem=function(a){var c=this,b="path"in this?this.path[0]:this;if(b["#opts"]&&
b["#opts"].spreadsheet)return this[a];if(b["#opts"]&&b["#opts"].providers&&"object"==typeof this[a]){var d=this.path||[this];d.push(this[a]);Object.defineProperties(this[a],{id:{value:a,enumerable:!1},path:{value:d,enumerable:!1,writable:!0,configurable:!0}});Object.getOwnPropertyNames(b.__proto__).forEach(function(d){return Object.defineProperty(c[a],d,{value:b.__proto__[d],enumerable:!1})});return this[a]}return this.hasOwnProperty(a)?String(this[a]):null};b.prototype.setItem=function(a,c){var b=
"path"in this?this.path[0]:this;if(b["#opts"])if(b["#opts"].cookie)b=new Date,b.setTime(b.getTime()+864E5),document.cookie=a+"="+c+";path=/;expires="+b.toUTCString();else if(b["#opts"].providers){var d=this[a];this[a]=c;var g={},h;for(h in b["#data"])g.$jscomp$loop$prop$d$2=b["#data"][h].config,"path"in this&&this.path.slice(1).forEach(function(a){return function(b){return a.$jscomp$loop$prop$d$2=a.$jscomp$loop$prop$d$2[b.id]}}(g)),g.$jscomp$loop$prop$d$2[a]=c,g={$jscomp$loop$prop$d$2:g.$jscomp$loop$prop$d$2};
"path"in this&&b.save(a,d,c);return}this[a]=void 0===c?null:String(c)};b.prototype.removeItem=function(a){var b="path"in this?this.path[0]:this;if(b["#opts"])if(b["#opts"].cookie)document.cookie=a+"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;";else if(b["#opts"].providers){var f=this[a];this[a]=void 0;delete this[a];var d={},g;for(g in b["#data"])d.$jscomp$loop$prop$d$4=b["#data"][g].config,"path"in this&&this.path.slice(1).forEach(function(a){return function(b){return a.$jscomp$loop$prop$d$4=
a.$jscomp$loop$prop$d$4[b.id]}}(d)),d.$jscomp$loop$prop$d$4[a]=void 0,delete d.$jscomp$loop$prop$d$4[a],d={$jscomp$loop$prop$d$4:d.$jscomp$loop$prop$d$4};"path"in this&&b.save(a,f,void 0);return}this[a]=void 0;delete this[a]};b.prototype.clear=function(){var a=this;Object.keys(this).forEach(function(b){return delete a[b]});this.save()};b.prototype.key=function(a){if(void 0==a)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Object.keys(this)[a]};
b.prototype.save=function(a,b,f){var c=this;if(!a||b!==f){!this["#opts"].providers&&"BroadcastChannel"in window&&this["#broadcast"].postMessage({key:a,oldValue:b,newValue:f,url:location.href,type:"storage"});console.log("SAVE",this);var g="path"in this?this.path[0]:this;if(g["#opts"]&&g["#opts"].providers){for(var h in g["#data"])g["#data"][h].time=Math.round((new Date).getTime()/1E3);g["#timers"].save&&clearTimeout(g["#timers"].save);g["#timers"].save=setTimeout(function(){localStorage.setItem("syncStorageCache"+
(g["#opts"].prefix?"_"+g["#opts"].prefix:""),JSON.stringify(g["#data"]));c["#opts"].providers&&"BroadcastChannel"in window&&c["#broadcast"].postMessage({key:a,oldValue:b,newValue:f,url:location.href,type:"storage"});g["#timers"].sync&&clearTimeout(g["#timers"].sync);g["#timers"].sync=setTimeout(function(){"gapi"in window&&gapi.auth2.getAuthInstance().isSignedIn.get()&&g["#data"].forEach(function(a){console.log("sync",a.config);gapi.client.request({path:"/upload/drive/v3/files/"+a.id,method:"PATCH",
params:{uploadType:"media"},body:"string"==typeof a.config?a.config:JSON.stringify(a.config)}).then(function(){},function(a){return console.log("error sync",a)})});delete g["#timers"].sync},2250);delete g["#timers"].save},250)}}};b.default=function(a){return{id:null,time:null,user:null,token:{},config:a||{welcome:!1}}};b.merge=function(){for(var a,b,f={},d=[].splice.call(arguments,0);0<d.length;)if("[object Object]"==toString.call(a=d.splice(0,1)[0]))for(b in a)a.hasOwnProperty(b)&&("[object Object]"==
toString.call(a[b])?f[b]=this.merge(f[b]||{},a[b]):f[b]&&"[object Array]"==toString.call(a[b])?0<Object.keys(a[b]).length&&(f[b]=a[b].concat(f[b])):f[b]=a[b]);return f};b.init=function(){window.globalStorage=this;"sessionStorage"in window||(window.sessionStorage=new this);"localStorage"in window||(window.localStorage=new this);window.cookieStorage=new this({cookie:!0})};$jscomp.global.Object.defineProperties(b.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Object.keys(this).length}}});
b.init()})();